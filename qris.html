<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pembayaran InAct QRIS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        background: #f2f6fb;
        font-family: "Segoe UI", Arial, sans-serif;
      }
    </style>
  </head>
  <body class="min-h-screen flex items-center justify-center py-8">
    <div
      class="max-w-sm mx-auto bg-white rounded-2xl shadow-xl overflow-hidden">
      <!-- Header Biru -->
      <div class="bg-blue-600 text-white py-6 text-center">
        <img
          src="https://images.seeklogo.com/logo-png/39/2/quick-response-code-indonesia-standard-qris-logo-png_seeklogo-391791.png"
          alt="QRIS"
          class="w-20 mx-auto mb-2" />
        <h1 class="text-xl font-bold">Pembayaran QRIS</h1>
      </div>

      <div class="p-6 text-center">
        <!-- Tanggal Hari Ini -->
        <p id="todayDate" class="text-gray-800 font-semibold mb-4"></p>

        <!-- Nama Produk -->
        <h2 id="productName" class="text-lg font-medium text-gray-700 mb-3">
          Loading...
        </h2>

        <!-- Total Pembayaran -->
        <p class="text-gray-600 text-sm">Total Pembayaran</p>
        <p id="price" class="text-4xl font-extrabold text-red-600 my-2">
          Loading...
        </p>

        <!-- QR Code -->
        <div class="my-6 p-4 bg-gray-100 rounded-lg">
          <img
            id="qrImage"
            src="https://www.bhinneka.com/blog/wp-content/uploads/2023/01/QR-Code.jpg"
            alt="QRIS Code"
            class="w-64 h-64 mx-auto object-contain" />
        </div>

        <!-- Batas Waktu -->
        <p class="text-gray-600 text-sm">Lakukan pembayaran sebelum</p>
        <p id="expiredText" class="text-lg font-bold text-red-700"></p>

        <div class="mt-6 text-xs text-gray-500">
          Setelah pembayaran berhasil, lisensi akan otomatis aktif dalam 1-5
          menit.
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>
      // Ambil parameter id dari URL
      const urlParams = new URLSearchParams(window.location.search);
      const id = urlParams.get("id");

      // Data JSON (bisa diganti dengan URL GitHub kamu)
      const jsonUrl =
        "https://fiansyahm31125.github.io/dummy-payment/checkout.json";

      // Tanggal hari ini (format Indonesia)
      const now = new Date();
      const dateFmt = new Intl.DateTimeFormat("id-ID", {
        weekday: "long",
        day: "2-digit",
        month: "long",
        year: "numeric",
      });
      $("#todayDate").text(dateFmt.format(now));

      // Format expired (bisa dari JSON atau +24 jam otomatis)
      const timeFmt = new Intl.DateTimeFormat("id-ID", {
        weekday: "long",
        day: "2-digit",
        month: "long",
        year: "numeric",
        hour: "2-digit",
        minute: "2-digit",
      });

      if (!id) {
        $("#productName").text("Error");
        $("#price").text("ID tidak ditemukan");
        $("#expiredText").text("-");
        return;
      }

      // Fetch data produk
      fetch(jsonUrl)
        .then((res) => res.json())
        .then((data) => {
          // Cari produk berdasarkan id_product
          const product = data.qris.find((item) => item.id_product == id);

          if (!product) {
            $("#productName").text("Produk tidak ditemukan");
            $("#price").text("ID salah");
            return;
          }

          // Isi data
          $("#productName").text(product.name);
          $("#price").text(
            "Rp " + Number(product.price).toLocaleString("id-ID")
          );

          // QR Image (jika ada di JSON, pakai itu. Kalau tidak, pakai default per produk)
          if (product.qr_image) {
            $("#qrImage").attr("src", product.qr_image);
          } else {
            // Default QR berdasarkan ID (bisa diganti sesuka hati)
            const defaultQrs = {
              111: "https://fiansyahm31125.github.io/dummy-payment/qr/750k.jpg",
              222: "https://fiansyahm31125.github.io/dummy-payment/qr/2250k.jpg",
              333: "https://fiansyahm31125.github.io/dummy-payment/qr/110k.jpg",
            };
            $("#qrImage").attr(
              "src",
              defaultQrs[id] || "https://i.imgur.com/4QwZ1bF.png"
            );
          }

          // Expired custom dari JSON (opsional) atau +23 jam 59 menit
          let expiredDate;
          if (product.expired) {
            expiredDate = new Date(product.expired);
          } else {
            expiredDate = new Date(
              now.getTime() + (23 * 60 * 60 * 1000 + 59 * 60 * 1000)
            );
          }
          $("#expiredText").text(timeFmt.format(expiredDate) + " WIB");
        })
        .catch((err) => {
          console.error(err);
          $("#productName").text("Error");
          $("#price").text("Gagal memuat data");
        });
    </script>
  </body>
</html>
