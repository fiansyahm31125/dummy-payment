<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

    <style>
      body {
        background: #f2f6fb;
        font-family: Arial, sans-serif;
      }
    </style>
  </head>

  <body>
    <div
      class="max-w-sm mx-auto bg-white shadow-md rounded-lg p-5 mt-6 text-center">
      <!-- Logo QRIS -->
      <img
        src="https://images.seeklogo.com/logo-png/39/2/quick-response-code-indonesia-standard-qris-logo-png_seeklogo-391791.png"
        class="w-24 mx-auto mb-3" />

      <!-- Tanggal Hari Ini -->
      <p id="todayDate" class="text-gray-800 font-semibold mb-2"></p>

      <!-- Total Pembayaran -->
      <p class="text-gray-600 text-sm">Total Pembayaran</p>
      <p id="price" class="text-3xl font-extrabold text-red-600">Loading...</p>

      <!-- QR Code -->
      <div class="flex justify-center my-4">
        <img
          id="qrImage"
          src="https://www.bhinneka.com/blog/wp-content/uploads/2023/01/QR-Code.jpg"
          class="w-56 h-56 object-contain" />
      </div>

      <!-- Batas Waktu -->
      <p class="text-gray-600 text-sm">Lakukan Pembayaran Sebelum</p>
      <p class="text-gray-900 font-semibold" id="expiredText"></p>
    </div>
  </body>

  <script src="https://code.jquery.com/jquery-3.7.1.js"></script>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get("id");

    const qrisUrl =
      "https://fiansyahm31125.github.io/dummy-payment/checkout.json";

    // === TANGGAL HARI INI ===
    const now = new Date();
    const todayFormatter = new Intl.DateTimeFormat("id-ID", {
      weekday: "long",
      day: "2-digit",
      month: "long",
      year: "numeric",
    });
    $("#todayDate").text(todayFormatter.format(now));

    // === BATAS WAKTU: +23 JAM 59 MENIT ===
    const expiredTime = new Date(now.getTime() + (23 * 60 + 59) * 60 * 1000);

    const expiredFormatter = new Intl.DateTimeFormat("id-ID", {
      weekday: "long",
      day: "2-digit",
      month: "long",
      year: "numeric",
      hour: "2-digit",
      minute: "2-digit",
    });

    // Set teks awal sebelum fetch JSON (fallback)
    $("#expiredText").text(expiredFormatter.format(expiredTime) + " WIB");

    // === FETCH DATA QRIS ===
    if (!id) {
      $("#price").text("ID not found");
    } else {
      fetch(qrisUrl)
        .then((res) => res.json())
        .then((data) => {
          const item = data.qris.find((item) => item.id_product == id);

          if (item) {
            $("#price").text("Rp " + Number(item.price).toLocaleString());

            if (item.qr_image) {
              $("#qrImage").attr("src", item.qr_image);
            }

            // Jika JSON punya expired â†’ override perhitungan otomatis
            if (item.expired) {
              const exp = new Date(item.expired);
              $("#expiredText").text(expiredFormatter.format(exp) + " WIB");
            }
          } else {
            $("#price").text("QRIS ID not found");
          }
        })
        .catch((err) => {
          console.error(err);
          $("#price").text("Error loading data");
        });
    }
  </script>
</html>
